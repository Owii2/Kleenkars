<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kleenkars — Premium Wash & Detailing</title>
<meta name="description" content="Book Kleenkars: Bike • Hatch/Sedan • SUV. Premium car care, doorstep or in-shop.">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0b0b12;--card:#13131b;--ink:#e9e9ef;--muted:#b8b8c6;--accent:#7a3cff;--accent-2:#111016;--border:#242433;--radius:16px;--shadow:0 10px 30px rgba(0,0,0,.35)}
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:
    radial-gradient(1000px 600px at 80% -10%, rgba(122,60,255,.15), transparent 60%),
    radial-gradient(900px 500px at -10% 20%, rgba(122,60,255,.12), transparent 60%), var(--bg);
    color:var(--ink);line-height:1.6}
  a{color:var(--ink);text-decoration:none}
  .wrap{max-width:1100px;margin:auto;padding:20px}
  header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:8px 0 20px}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{width:48px;height:48px;object-fit:contain;border-radius:10px;background:#0f0f16;border:1px solid var(--border)}
  .title{font-weight:800;letter-spacing:.3px}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--border);color:var(--muted);font-size:.85rem}
  .btn{appearance:none;border:1px solid var(--border);background:var(--accent-2);color:#fff;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;transition:.2s transform ease}
  .btn:hover{transform:translateY(-1px)}
  .btn.primary{background:linear-gradient(0deg, rgba(122,60,255,.2), rgba(122,60,255,.2)), var(--accent);border-color:#5c29ef}
  .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)), var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  .p24{padding:24px}
  .hero{display:grid;grid-template-columns:1.1fr .9fr;gap:24px;align-items:stretch}
  .hero h1{margin:0 0 10px;font-size:clamp(26px,3.5vw,44px);line-height:1.1}
  .sub{color:var(--muted);margin:4px 0 18px}
  .grid{display:grid;gap:12px}
  .two{grid-template-columns:1fr 1fr}
  label{font-weight:600;font-size:.92rem}
  input,select,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:#0f0f16;color:var(--ink);outline:none}
  input::placeholder,textarea::placeholder{color:#6f6f84}
  .help{font-size:.85rem;color:var(--muted)}
  .err{color:#ff9a9a;font-size:.85rem;margin-top:6px;display:none}
  .price{margin-top:10px;font-weight:800;font-size:1.1rem;background:#101018;border:1px dashed #2a2a3a;padding:10px 12px;border-radius:12px}
  .radio-row{display:flex;gap:10px;flex-wrap:wrap}
  .radio{display:flex;align-items:center;gap:8px;border:1px solid var(--border);padding:8px 10px;border-radius:10px;background:#0f0f16}
  .hero-media{display:block;position:relative;border-radius:16px;border:1px solid var(--border);overflow:hidden;aspect-ratio:16/9;background:#0f0f16}
  .hero-media img{width:100%;height:100%;object-fit:cover;display:block}
  footer{opacity:.9;padding:28px 8px;text-align:center;color:var(--muted)}
  @media (max-width:780px){.hero{grid-template-columns:1fr}.hero-media{aspect-ratio:3/2}}
  .toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#0f0f16;border:1px solid #2a2a3a;padding:12px 16px;border-radius:12px;display:none;z-index:99}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <img src="/assets/logo.png" alt="Kleenkars logo" onerror="this.src='/logo.svg'">
        <div>
          <div class="title">Kleenkars</div>
          <div class="pill">Premium • Wash • Detailing</div>
        </div>
      </div>
      <a class="pill" href="/admin.html">Admin login</a>
    </header>

    <section class="hero">
      <div class="card p24">
        <h1>Premium car care.</h1>
        <p class="sub">More than a wash — it’s a Kleenkars experience.</p>

        <form id="booking" class="grid" autocomplete="on">
          <div class="grid two">
            <div>
              <label for="name">Customer name</label>
              <input id="name" name="name" placeholder="Full name" required>
            </div>
            <div>
              <label for="phone">Phone number</label>
              <input id="phone" name="phone" type="tel" inputmode="numeric" autocomplete="tel"
                     placeholder="10-digit mobile" maxlength="10" pattern="[0-9]{10}" required>
            </div>
          </div>

          <div class="grid two">
            <div>
              <label for="vehicle">Vehicle type</label>
              <select id="vehicle" name="vehicle" required>
                <option value="" disabled selected>Select</option>
                <option value="Bike">Bike</option>
                <option value="Hatch/Sedan">Hatchback / Sedan</option>
                <option value="SUV">SUV</option>
              </select>
              <div class="help">Bike supports <b>Basic</b> only.</div>
            </div>
            <div>
              <label for="service">Service</label>
              <select id="service" name="service" required>
                <option value="" disabled selected>Select</option>
                <option value="Basic">Basic Wash</option>
                <option value="Premium">Premium Car Wash</option>
                <option value="Detailing">Detailing</option>
              </select>
              <div class="help">
                Basic: Bike ₹50 • Hatch/Sedan ₹150 • SUV ₹200<br>
                Premium: Hatch/Sedan ₹200 • SUV ₹250<br>
                Detailing: Hatch/Sedan ₹1500 • SUV ₹2500
              </div>
            </div>
          </div>

          <div class="grid two">
            <div>
              <label for="date">Preferred date</label>
              <input type="date" id="date" name="date" required>
            </div>
            <div>
              <label for="time">Preferred time <span class="help">(10:00 AM–8:00 PM IST)</span></label>
              <input type="time" id="time" name="time" required min="10:00" max="20:00" step="900">
              <div id="timeErr" class="err">Please pick a time between 10:00 AM and 8:00 PM.</div>
            </div>
          </div>

          <div>
            <label>Visit type</label>
            <div class="radio-row">
              <label class="radio"><input type="radio" name="visit" value="In-Shop" checked> In-Shop</label>
              <label class="radio"><input type="radio" name="visit" value="Home Visit"> Home Visit (+₹50)</label>
            </div>
          </div>

          <div id="addressWrap" style="display:none;">
            <label for="address">Address (for Home Visit)</label>
            <textarea id="address" name="address" rows="2" placeholder="House/Flat, Street, Area, City"></textarea>
          </div>

          <div class="price" id="priceBox">Estimated price: —</div>

          <button class="btn primary" type="button" id="confirm">Confirm Booking</button>
          <div class="help">Confirm saves your booking and opens WhatsApp confirmation.</div>
        </form>
      </div>

      <picture class="hero-media" aria-label="Kleenkars foam wash in action">
        <source srcset="/assets/hero.webp" type="image/webp">
        <img src="/assets/hero.jpg" alt="Kleenkars foam wash in action" loading="lazy" decoding="async">
      </picture>
    </section>

    <footer>© <span id="yr"></span> Kleenkars • Aligarh • Open 10:00–20:00 Daily</footer>
  </div>

  <div class="toast" id="toast">✅ Booking confirmed!</div>

<script>
  // --- Pricing & rules
  const PRICES = {
    "Bike":        { "Basic": 50,  "Premium": null, "Detailing": null },
    "Hatch/Sedan": { "Basic": 150, "Premium": 200,  "Detailing": 1500 },
    "SUV":         { "Basic": 200, "Premium": 250,  "Detailing": 2500 }
  };
  const HOME_SURCHARGE = 50;

  // --- Elements
  const els = {
    vehicle: document.getElementById('vehicle'),
    service: document.getElementById('service'),
    name: document.getElementById('name'),
    phone: document.getElementById('phone'),
    date: document.getElementById('date'),
    time: document.getElementById('time'),
    timeErr: document.getElementById('timeErr'),
    visitRadios: document.querySelectorAll('input[name="visit"]'),
    addressWrap: document.getElementById('addressWrap'),
    address: document.getElementById('address'),
    priceBox: document.getElementById('priceBox'),
    confirm: document.getElementById('confirm'),
    toast: document.getElementById('toast')
  };

  // --- Init
  document.getElementById('yr').textContent = new Date().getFullYear();
  els.date.setAttribute('min', new Date().toISOString().split('T')[0]);

  // sanitize phone as user types (digits only, max 10)
  els.phone.addEventListener('input', ()=>{
    els.phone.value = els.phone.value.replace(/\D/g,'').slice(0,10);
  });

  function getVisit(){ return [...els.visitRadios].find(r=>r.checked)?.value || "In-Shop"; }
  function applyServiceRules(){
    const v = els.vehicle.value;
    [...els.service.options].forEach(o => { if(!o.value) return; o.disabled = (PRICES[v]?.[o.value] == null); });
    if(v==="Bike") els.service.value = "Basic";
  }
  function computePrice(){
    const v = els.vehicle.value, s = els.service.value;
    let p = PRICES?.[v]?.[s] ?? null;
    if(p == null) return null;
    if(getVisit()==="Home Visit") p += HOME_SURCHARGE;
    return p;
  }
  function updatePriceUI(){
    const v = els.vehicle.value, s = els.service.value;
    const p = computePrice();
    if(p!=null){
      const extra = getVisit()==="Home Visit" ? ` (+₹${HOME_SURCHARGE} home visit)` : "";
      els.priceBox.innerHTML = `Estimated price: <b>₹${p}</b> <span class="help">(${s} • ${v}${extra})</span>`;
    } else if(v && s){
      els.priceBox.innerHTML = `Estimated price: <span class="help">Not available for ${v} — choose another service.</span>`;
    } else els.priceBox.textContent = "Estimated price: —";
  }
  function visitChanged(){
    const v = getVisit();
    els.addressWrap.style.display = v==="Home Visit" ? "block" : "none";
    if(v==="Home Visit"){ els.address?.setAttribute('required','required'); } else { els.address?.removeAttribute('required'); els.address.value=""; }
  }

  // Accepts HH:MM or HH:MM:SS; clamps and shows inline message for out-of-window picks
  function enforceTimeWindow(){
    const val = els.time.value;
    if(!val){ els.time.setCustomValidity(''); els.timeErr.style.display='none'; return false; }
    const parts = val.split(':').map(n=>parseInt(n,10));
    if(parts.length < 2 || Number.isNaN(parts[0]) || Number.isNaN(parts[1])){
      els.time.setCustomValidity('Pick a valid time'); els.timeErr.style.display='block'; return false;
    }
    const hh = parts[0], mm = parts[1];
    let mins = hh*60 + mm;

    const MIN = 10*60; // 600
    const MAX = 20*60; // 1200

    if(mins < MIN){ mins = MIN; snapTo(mins); showTimeError(); return false; }
    if(mins > MAX){ mins = MAX; snapTo(mins); showTimeError(); return false; }

    els.time.setCustomValidity(''); els.timeErr.style.display='none'; return true;
  }
  function snapTo(mins){
    const hh = String(Math.floor(mins/60)).padStart(2,'0');
    const mm = String(mins%60).padStart(2,'0');
    els.time.value = `${hh}:${mm}`;
  }
  function showTimeError(){
    els.time.setCustomValidity('Please pick a time between 10:00 and 20:00');
    els.time.reportValidity();
    els.timeErr.style.display='block';
  }

  function validTime(){ return enforceTimeWindow(); }

  // Bind dynamic behavior
  ['change','input','blur'].forEach(ev=> els.time.addEventListener(ev, enforceTimeWindow));
  ['change','input'].forEach(ev=>{
    els.vehicle.addEventListener(ev, ()=>{ applyServiceRules(); updatePriceUI(); });
    els.service.addEventListener(ev, updatePriceUI);
    els.date.addEventListener(ev, updatePriceUI);
    els.visitRadios.forEach(r=>r.addEventListener(ev, ()=>{ visitChanged(); updatePriceUI(); }));
    els.address?.addEventListener(ev, updatePriceUI);
  });
  applyServiceRules(); visitChanged(); updatePriceUI();

  // Submit with loading state
  els.confirm.addEventListener('click', async ()=>{
    if(!document.getElementById('booking').reportValidity()) return;

    if(!validTime()) return;

    const raw = (els.phone.value || '').replace(/\D/g,'');
    if(raw.length!==10){ alert("Enter a valid 10-digit number."); return; }
    if(PRICES?.[els.vehicle.value]?.[els.service.value] == null){
      alert(`${els.service.value} is not available for ${els.vehicle.value}.`);
      return;
    }

    const payload = {
      name: els.name.value.trim(),
      phone: raw,
      vehicle: els.vehicle.value,
      service: els.service.value,
      date: els.date.value,
      time: els.time.value,
      visit: getVisit(),
      address: (els.address?.value || "").trim(),
      price: computePrice()
    };

    const btn = els.confirm, oldLabel = btn.textContent;
    btn.disabled = true; btn.textContent = "Saving…";

    try{
      const r = await fetch("/.netlify/functions/saveBooking", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload)
      });
      const data = await r.json();
      if(!r.ok || !data.ok) throw new Error(data?.error || `Save failed (${r.status})`);

      showToast("✅ Booking confirmed!");
      const text = buildSummary();
      if(data.admin)   window.open(`https://wa.me/${data.admin}?text=${encodeURIComponent(text)}`, "_blank", "noopener");
      if(data.manager) window.open(`https://wa.me/${data.manager}?text=${encodeURIComponent("NEW BOOKING ALERT\n\n"+text)}`, "_blank", "noopener");

    }catch(err){
      console.error(err);
      alert(err.message || "Could not save booking. Please try again.");
    }finally{
      btn.disabled = false; btn.textContent = oldLabel;
    }
  });

  function buildSummary(){
    const v = els.vehicle.value, s = els.service.value, visit = getVisit();
    const extraAddr = visit==="Home Visit" && els.address?.value.trim() ? ` — ${els.address.value.trim()}` : "";
    const price = computePrice();
    return `KLEENKARS BOOKING

Name: ${els.name.value.trim()}
Customer WhatsApp: +91 ${els.phone.value.trim()}
Vehicle: ${v}
Service: ${s}
Visit: ${visit}${extraAddr}
Preferred: ${els.date.value} at ${els.time.value}
Estimated Price: ${price!=null ? "₹"+price : "TBC"}

Notes:
• Bike supports Basic only.
• Open hours: 10:00 to 20:00.`;
  }

  function showToast(msg){
    els.toast.textContent = msg;
    els.toast.style.display = 'block';
    setTimeout(()=> els.toast.style.display = 'none', 3000);
  }
</script>
</body>
</html>
